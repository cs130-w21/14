<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: screens/HomeScreen/HomeScreen.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: screens/HomeScreen/HomeScreen.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import React, {useCallback, useEffect, useState} from 'react';
import {RefreshControl, Alert, FlatList, ScrollView, ActivityIndicator, Text, View, SectionList} from 'react-native';
import {getGenres, genre2Labels, getBooksFromGenre, getReadingBooks, removeFromReading,addToPrefs } from '../../utils';
import BookModal from '../SelectScreen/BookModal';
import BookListItem from '../../common/BookListItem/BookListItem';
import styles from './styles';

/**
 * This is the React component which defines the UI for the Home screen in the app.
 *
 * @function HomeScreen
 * @param {Object} props - This is a dictionary of component properties.
 * @namespace
 */
export default function HomeScreen({extraData}) {
  const {name} = extraData?.user;
  const [hour, setHour ] = useState(0);
  const [ greeting, setGreeting ] = useState('Good Evening');
  const [recommendations, setRecommendations] = useState(undefined);
  const [loading, setLoading] = useState(true);
  const [reading, setReading] = useState(null);
  const [refreshing, setRefreshing] = useState(false);
  const [selectedBook, setSelectedBook] = useState(null);

  const getReading = async () => {
    const reading = await getReadingBooks();
    setLoading(false);
    if (reading)
      setReading(reading);
  }

  const getRecs = async () => {
    const genres = await getGenres();
    const recs = await genres.reduce(async (acc, genre) => {
      return [
        ...(await acc),
        { 
          title: genre2Labels[genre],
          data: (await getBooksFromGenre(genre, 2)),
        }
      ]
    }, []);
    setLoading(false);
    setRecommendations(recs);
  }

  // On the initial render, get the current time and list the user's recommended
  // books.
  useEffect(() => {
    setHour((new Date).getHours());

    getReading();
    getRecs();
  }, []);

  // Set the displayed greeting according to the time.
  useEffect(() => {
    if (17 &lt;= hour || hour &lt; 7) {
      setGreeting('Good Evening');
    } else if (7 &lt;= hour &amp;&amp; hour &lt; 12) {
      setGreeting('Good Morning');
    } else {
      setGreeting('Good Afternoon');
    }
  }, [hour]);

  const showBookAlert = (book) => {
    Alert.alert(
      'Opinion',
      'Did you like this book?',
      [
        {
          text: 'I\'m not done yet',
          onPress: () => {}
        },
        {
          text: 'No',
          onPress: async () => {
            await removeFromReading(book);
            await getReading();
          },
          style: 'cancel'
        },
        {
          text: 'Yes',
          onPress: async () => {
            await addToPrefs(book);
            await removeFromReading(book);
            await getReading();
          }
        }
      ]
    );
  }

  const onRefresh = useCallback(async () => {
    setRefreshing(true);
    try {
      await getReading().catch((e) => {console.error(e)});
      await getRecs().catch((e) => {console.error(e)});
    } catch (e) {
      console.error(e);
    }
    setRefreshing(false);
  }, []);

  return (
    &lt;ScrollView style={styles.container}
      refreshControl={
        &lt;RefreshControl
          refreshing={refreshing}
          onRefresh={onRefresh}
        />
      }
    >
      {selectedBook !== null &amp;&amp; 
        &lt;BookModal
          showModal={selectedBook !== null}
          book={selectedBook}
          onDismiss={() => {setSelectedBook(null)}}
        />}
      &lt;View style={styles.greetingContainer}>
        &lt;Text style={styles.greeting}>{greeting},&lt;/Text> 
        &lt;Text style={styles.name}>{name.split(' ')[0]} ðŸ‘‹ &lt;/Text>
      &lt;/View>
      {loading &amp;&amp;
          &lt;ActivityIndicator style={{margin: 50, transform: [{scale: 2}]}} size='large' color='#ff0000' />}
      {reading?.length > 0 &amp;&amp;
          (&lt;>
            &lt;Text style={styles.header}>Currently Reading&lt;/Text>
            &lt;FlatList
              scrollEnabled={false}
              data={reading}
              renderItem={({item}) => (
                &lt;BookListItem
                  book={item}
                  style={{ marginHorizontal: 0 }}
                  onPress={() => {
                    showBookAlert(item)
                  }}
                />
              )}
              keyExtractor={(item, index) => index}
            />
          &lt;/>)}
      {recommendations &amp;&amp;
        &lt;>&lt;Text style={styles.header}>Book Recommendations&lt;/Text>
          &lt;SectionList
            scrollEnabled={false}
            sections={recommendations}
            renderItem={({item}) =>
                (&lt;BookListItem book={item} style={{ marginHorizontal: 0 }} onPress={() => setSelectedBook(item)}/>)}
            renderSectionHeader={({section}) => (
              &lt;Text style={styles.sectionHeader}>{section.title}&lt;/Text>
            )}
            keyExtractor={(item, index) => index}
          />&lt;/>}
    &lt;/ScrollView>
  );
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Namespaces</h3><ul><li><a href="global.html#Button">Button</a></li><li><a href="Firebase.html">Firebase</a></li><li><a href="HomeScreen.html">HomeScreen</a></li><li><a href="HomeTabs.html">HomeTabs</a></li><li><a href="ImagePicker.html">ImagePicker</a></li><li><a href="LoginScreen.html">LoginScreen</a></li><li><a href="ProfileScreen.html">ProfileScreen</a></li><li><a href="Recommender.html">Recommender</a></li><li><a href="RegistrationScreen.html">RegistrationScreen</a></li><li><a href="screens.html">screens</a></li><li><a href="SelectScreen.html">SelectScreen</a></li><li><a href="SelectScreen.BookListItem.html">BookListItem</a></li><li><a href="Utilities.html">Utilities</a></li></ul><h3><a href="global.html">Global</a></h3>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.4</a> on Mon Mar 08 2021 01:25:29 GMT+0000 (Coordinated Universal Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
